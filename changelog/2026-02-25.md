# 2026-02-25 — Repo Cleanup & Hygiene

## Migration Fix (Critical)
- Fixed duplicate migration ID `'011'` in `src/lib/db/migrations.ts` → renamed to `'015b'`
- Added duplicate ID detection in `runMigrations()` — throws on startup if duplicates found
- **Result:** Test suite went from 31/101 to 101/101 passing

## Build Artifact Cleanup
- Removed committed `coverage/`, `playwright-report/`, `test-results/`, `tsconfig.tsbuildinfo`
- Removed unreferenced `docs/images/mission_control.png` (489K)

## Console Logging Audit
- Removed debug `console.log` in `PlanningTab.tsx` (dispatch retry)
- Kept all `console.error`/`console.warn` in catch blocks (appropriate for PM2 logging)
- SSEDebugPanel console interception is intentional (gated by MC_DEBUG flag)

## Documentation Consolidation
- Moved 7 root .md files to `docs/` directory
- Updated cross-references in README.md, heartbeat, quickstart, production-setup docs
- Root now has 4 .md files: README, CHANGELOG, AGENTS, CLAUDE

## AgentDetailPanel Decomposition
- Split 700-line component into 4 focused sub-components:
  - `AgentOverviewSection.tsx` (125 LOC)
  - `AgentCapabilitiesSection.tsx` (228 LOC)
  - `AgentCronsSection.tsx` (109 LOC)
  - `AgentMarkdownTab.tsx` (25 LOC)
- Orchestrator reduced to 338 LOC

## API Route DRY-up
- Created `src/lib/api-helpers.ts` with `buildPatchQuery()` and `notFound()`
- Refactored 5 PATCH handlers (agents, capabilities, crons, integrations, workspaces)

## CLAUDE.md & AGENTS.md Upgrades
- Added code hygiene rules, post-task reflection protocol
- Fixed incorrect "7 known middleware auth failures" → 101/101 passing
- Fixed incorrect "IPv6 bug" gotcha → documented real migration ID issue
- Added autonomy boundaries, expanded anti-patterns
- Created `changelog/` system

---

## UI Polish & Crons 3-View Revamp
- Granular task counts (inbox/in_progress/testing/done breakdown)
- "Activate" → "Initialize" button rename
- Live Feed filters + agent names
- Health "Not Checked" + em-dash for missing fields
- Crons 3-view revamp: Per Agent, Overview (summary cards), Calendar (weekday grid)
- Memory page + Agents page workspace isolation
- Workspace main page sidebar filter by workspace_id

## Cron Views Browser Validation
- Created 3 test cron jobs via CronModal (shell, LLM types; weekday/Friday/every-15-min schedules)
- **Per Agent view:** groups by agent, collapsible, active count badges — PASS
- **Overview view:** summary cards (Total/Active/Disabled/Stale) + Recent Runs — PASS
- **Calendar view:** correct weekday mapping, time-sorted entries, agent names — PASS
- Edit modal opens pre-filled — PASS
- Toggle disable/enable updates badge + button — PASS

## Data Cleanup
- Deleted 18 stale test tasks (16 inbox, 1 in-progress, 1 testing)
- Deleted mystery agent `911703b0-...` (auto-created UUID with no config)

## Dogfood QA — Initiative System + Task Overhaul (Post-9a62cf9)
- **Systematic Playwright testing** across 7 groups, 9 tests, 15 features verified
- **All 7 kanban columns** render correctly; view toggle (Flat / By Initiative) works
- **"+" dropdown menu** confirmed working with New Initiative + New Task options
- **Task creation** end-to-end: modal → form → save → card in INBOX → Live Feed event
- **By Initiative view:** Ungrouped swimlane, collapse chevrons, task counts
- **Agents sidebar:** filter tabs (all/working/standby), Add Agent button
- **APIs verified:** /api/task-types (6 types, 3 implemented), /api/initiatives, /api/tasks
- **Zero console errors** across all pages

### Fixes from dogfood findings
- **Task card footer overlap (low):** Added `gap-2` + `flex-shrink-0` + `truncate` to prevent priority/timestamp text collision
- **Quick Add Tasks in InitiativeModal (medium):** Added textarea for bulk task creation — enter titles one per line, auto-linked to initiative
- **Initiative POST endpoint (medium):** Added `POST /api/initiatives` handler for server-side persistence to `initiative_cache` table
